@inherits RealtimeComponent

<figure class="avatar @(HasEmoji ? "emoji" : "") @(CanEdit ? "editable" : "")" style="background: @User.BackgroundColor" @onclick=Edit>
    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <circle cx="50" cy="50" r="45" fill="@User.ForegroundColor" />
        <text x="50%" y="60%" font-size="80" text-anchor="middle" dominant-baseline="middle" style="fill: @User.ForegroundColor">
            @Emoji
        </text>
    </svg>
    <figcaption style="color: @User.ForegroundColor">
        @User.Name
        <aside>
            @User.Language &#8226; @User.Pronouns
        </aside>
    </figcaption>
</figure>

@if (CanEdit && ShowEditor)
{
    <Ibis.Web.Onboarding.Index OnDone="CloseEditor" />
}

@code {
    [Parameter] public UserAvatar User { get; set; } = null!;
    [Parameter] public bool CanEdit { get; set; }
    bool ShowEditor;

    protected override async Task OnInitializedAsync()
    {
        await On<UserAvatarUpdated>(User.Id, x => User = x.Avatar);
    }

    bool HasEmoji => !string.IsNullOrWhiteSpace(User.Emoji);
    string Emoji => !HasEmoji
        ? User.Initials
        : User.Emoji;

    void Edit()
    {
        if (!CanEdit)
            return;

        ShowEditor = true;
    }

    void CloseEditor() => ShowEditor = false;
}

