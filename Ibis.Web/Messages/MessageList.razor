@inherits RealtimeComponent

<div class="message-grid">
    <div class="message-list">
        <Virtualize Items="Messages" Context="message">
            <MessageCard Message="message" />
        </Virtualize>
    </div>
</div>

@code {
    [Parameter] public string RoomId { get; set; } = null!;
    List<Message> Messages = new();

    protected override void OnInitialized()
    {
        On<MessageTextChanged>(x =>
        {
            if (x.Message.RoomId == RoomId)
                AddMessage(x.Message);
        });
    }

    void AddMessage(Message message)
    {
        var existingId = Messages.FindIndex(x => x.Id == message.Id);
        if (existingId > -1)
            Messages[existingId] = message;
        else
            Messages.Add(message);
    }

}
