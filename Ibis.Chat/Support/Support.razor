<div class="support support--container" tabindex="0">
    <div class="support-language">
        <button tabindex="0" class="open-language-settings @ShowLanguageSettings" @onclick="ToggleLanguageSettings">
            <span>@User.Language</span>
        </button>
        <button tabindex="0" class="play-button">
            <PlayIcon2 />
        </button>
        <div class="language-settings @ShowLanguageSettings">
            <SupportLanguage />
        </div>
    </div>
    <div class="support-helpdesk">
        <button tabindex="0" class="open-helpdesk" @onclick=ToggleHelpdesk>
            <SupportIcon BackgroundColor="@BackgroundColor" />
        </button>
        <div class="helpdesk @ShowHelpdesk">
            <SupportHelpdesk OnClose="ToggleHelpdesk"/>
        </div>
    </div>
    <div class="support--overlay @ShowOverlay" @onclick="ToggleLanguageSettings"></div>
</div>

@code {
    [CascadingParameter] public UserAvatar User { get; set; } = null!;
    [Parameter] public bool? PreviewHelpdesk { get; set; } = false;
    [Parameter] public EventCallback ClosePreview { get; set; }

    bool OpenLanguageSettings = false;
    string? ShowLanguageSettings;
    string? ShowOverlay = "";

    bool? OpenHelpdesk = false;
    string? ShowHelpdesk;
    string? BackgroundColor = "#003B5F";

    protected override void OnParametersSet()
    {
        if (PreviewHelpdesk == true)
        {
            OpenHelpdesk = true;
            ShowHelpdesk = "open";
            BackgroundColor = "#00608B";
            Console.WriteLine("showing preview");
        }
    }

    void ToggleLanguageSettings()
    {
        OpenLanguageSettings = !OpenLanguageSettings;

        if (OpenLanguageSettings == false)
        {
            ShowLanguageSettings = "";
            ShowOverlay = "";
        } else
        {
            ShowLanguageSettings = "open";
            ShowOverlay = "show";
            BackgroundColor = "#003B5F";
        }

        if (OpenHelpdesk == true)
        {
            OpenHelpdesk = false;
            ShowHelpdesk = "";
        }
    }

    async void ToggleHelpdesk()
    {
        OpenHelpdesk = !OpenHelpdesk;

        if (OpenHelpdesk == false)
        {
            ShowHelpdesk = "";
            BackgroundColor = "#003B5F";
            await ClosePreview.InvokeAsync();
        }
        else
        {
            ShowHelpdesk = "open";
            BackgroundColor = "#00608B";
        }

        if(OpenLanguageSettings == true)
        {
            OpenLanguageSettings = false;
            ShowLanguageSettings = "";
        }
    }
}